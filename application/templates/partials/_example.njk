{% macro example(params) %}
  {% set exampleRef = params.example | default("default") %}
  {% set exampleURL = "/hmrc-design-patterns/" + params.item + "/" + exampleRef + "/" %}
  {% set examplePath = "src" + exampleURL + "index.njk" %}
  {% set exampleId = "example-" + exampleRef %}
  {% set description = params.description %}
  {% if params.welsh %}
    {% set welshExampleRef = params.welsh | default("default") %}
    {% set welshExampleURL = "/hmrc-design-patterns/" + params.item + "/" + welshExampleRef + "/" %}
    {% set welshExamplePath = "src" + welshExampleURL + "index.njk" %}
  {% endif %}

  <div class="app-example-wrapper app-example__language-switch--en-activated" id="{{ exampleId }}" data-module="app-tabs app-language-switch-example">

    <div class="app-example app-example--tabs">
      <span class="app-example__link app-example__new-window">
        <a href="{{ exampleURL }}" target="_blank" title="Open {{description}} example in a new window">
          Open this example in a new window
        </a>
      </span>
      {% if welshExampleURL %}
        <span class="app-example__link app-example__language-switch app-example__language-switch--current">
          <a href="{{ exampleURL }}" data-lang="en" target="_blank" data-track="lang-switch-en" title="Display {{description}} example in English">
            Display in English
          </a>
        </span>
        <span class="app-example__link app-example__language-switch js-enabled">
          <a href="{{ welshExampleURL }}" data-lang="cy" target="_blank" data-track="lang-switch-cy" title="Display {{description}} example in Welsh">
            Display in Welsh
          </a>
        </span>
      {% endif %}
      <iframe data-module="app-example-frame" class="app-example__frame app-example__frame--resizable"
              src="{{ exampleURL }}"{% if description %} title="{{description}} example"{% endif %}></iframe>
    </div>

    <div class="example-{{ exampleId }}-lang example-{{ exampleId }}-lang--en ">
      <span id="options-{{ exampleId }}"></span>
      <ul class="app-tabs" role="tablist">
        <li class="app-tabs__item js-tabs__item" role="presentation">
          <a href="#{{ exampleId }}-html" role="tab"
            aria-controls="{{ exampleId }}-html"
            data-track="tab-html" title="Display {{description}} example as HTML">HTML</a>
        </li>
        <li class="app-tabs__item js-tabs__item" role="presentation">
          <a href="#{{ exampleId }}-nunjucks" role="tab"
            aria-controls="{{ exampleId }}-nunjucks"
            data-track="tab-nunjucks" title="Display {{description}} example as Nunjucks">Nunjucks</a>
        </li>
      </ul>

      <div class="app-tabs__container js-tabs__container" id="{{ exampleId }}-html" role="tabpanel">
        <!-- TODO: Create copy link macro - several instances of this -->
        <div class="app-link--copy__container">
          <a class="govuk-link app-link--copy" href="#copy" aria-live="assertive" data-module="copy-to-clipboard">Copy</a>
        </div>
        <div data-module="app-copy">
          <pre class="app-example__language-switch--en-only-content">
            <code class="hljs html">
              {{- getHTMLCode(examplePath) | highlight('html') | safe -}}
            </code>
          </pre>

          {% if welshExamplePath %}
            <pre class="app-example__language-switch--cy-only-content">
              <code class="hljs html">
                {{- getHTMLCode(welshExamplePath) | highlight('html') | safe -}}
              </code>
            </pre>
          {% endif %}
        </div>
      </div>

      <div class="app-tabs__container js-tabs__container" id="{{ exampleId }}-nunjucks" role="tabpanel">
        {% from "govuk/components/details/macro.njk" import govukDetails %}

        {% set macroOptions = getMacroOptions(params.item) %}

        {% if macroOptions %}
          {% set macroOptionsHTML %}

            <p>
            Use options to customise the appearance, content and behaviour of a component when using a macro, for example, changing the text.
            </p>
            <p>
            Some options are required for the macro to work; these are marked as "Required" in the option description.
            </p>
            <p>
            If you're using Nunjucks macros in production with "html" options, or ones ending with "html", you must sanitise the HTML to protect against  <a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting">cross-site scripting exploits</a>.
            </p>

            {% for table in macroOptions %}
              <table class="govuk-table app-options__table" id="options-{{ exampleId }}--{{ table.id }}">
                <caption class="govuk-table__caption govuk-heading-m {% if table.id == 'primary' %} govuk-visually-hidden{% endif %}">{{ table.name }}</caption>
                <thead class="govuk-table__head">
                  <tr class="govuk-table__row">
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">Name</th>
                    <th class="govuk-table__header app-options__limit-table-cell" scope="col">Type</th>
                    <th class="govuk-table__header" scope="col">Description</th>
                  </tr>
                </thead>
                <tbody class="govuk-table__body">

                  {% for option in table.options %}
                    <tr class="govuk-table__row">
                      <th class="govuk-table__header" scope="row">{{option.name}}</th>
                      <td class="govuk-table__cell ">{{option.type}}</td>
                      <td class="govuk-table__cell ">
                        {% if (option.required === true) %}
                          <strong>Required.</strong>
                        {% endif %}
                        {{ option.description | safe }}
                        {% if (option.isComponent) %}
                          {# Create separate table data for components that are hidden in the Design System #}
                          {% if (option.name === "hint" or option.name === "label") %}
                            See <a href="#options-{{ exampleId }}--{{ option.name }}">{{ option.name }}</a>.
                          {% else %}
                            See <a href="/components/{{ option.slug }}/#options-example-default">{{ option.name }}</a>.
                          {% endif %}
                        {% endif %}
                        {% if (option.params) %}
                          See <a href="#options-{{ exampleId }}--{{ option.name }}">{{ option.name }}</a>.
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% endfor %}
          {% endset %}

          <div class="app-example--options__container">
            {{ govukDetails({
              summaryHtml: "<span data-components='github-component-arguments'>Nunjucks macro options</span>",
              html: macroOptionsHTML,
              classes: "app-options",
              attributes:{
                id: "options-" + exampleId + "-details"
              }
            })}}
          </div>

        {% endif %}

        <div class="app-link--copy__container">
          <a class="govuk-link app-link--copy" href="#copy" aria-live="assertive" data-module="copy-to-clipboard">Copy</a>
        </div>
        <div data-module="app-copy">
          <pre class="app-example__language-switch--en-only-content">
            <code class="hljs js">
            {{- getNunjucksCode(examplePath) | highlight('js') | safe -}}
            </code>
          </pre>

          {% if welshExamplePath %}
            <pre class="app-example__language-switch--cy-only-content">
              <code class="hljs js">
                {{- getNunjucksCode(welshExamplePath) | highlight('js') | safe -}}
              </code>
            </pre>
          {% endif %}
        </div>
      </div>
    </div>

  </div>

{% endmacro %}
