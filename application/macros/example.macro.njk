{%- macro example(params) -%}
{%  set directoryPath = filepath | dirname %}
{%- set exampleLocation = params.html -%}
{%- set multiPage = (params.html | is_array) -%}
{%- set showExampleCode = params.showExampleCode | default(false if multiPage else true, true) %}
{%- if multiPage -%}{%- set exampleLocation = params.html[0] -%}{%- endif -%}
{%- set welshExampleLocation = exampleLocation | replace(".html", ".cy.html") -%}
{%  set htmlExampleLocation = directoryPath + "/examples/" + exampleLocation %}
{%- set welshHtmlExampleLocation = htmlExampleLocation | replace(".html", ".cy.html") -%}
{%  set nunjucksExampleLocation = directoryPath + "/examples/" + params.nunjucks %}
{%- set exampleId = (exampleLocation | replace(".html", "")) %}
{%- set iframeHeight = params.height | default(153, true) -%}
<div class="app-example-wrapper js-example">
    <div class="app-example app-example--tabs">
        <span class="app-example__link">
            <a href="examples/{{ exampleLocation }}" target="_blank" class="new-window-link">
                Open this <span class="govuk-visually-hidden">{{ exampleId }}</span> example in a new window
            </a>
        </span>
        {% if hasWelsh %}{% include '../partials/welsh-toggle.njk' %}{% endif %}
        <iframe name="{{ exampleId }}_frame" 
        class="app-example__frame app-example__frame--resizable js-example__frame"
            src="examples/{{ exampleLocation }}" 
            frameborder="0" id="{{ exampleId }}_frame" 
            height="{{ iframeHeight }}"
            scrolling="auto"></iframe>
        {% if showExampleCode %}
            <ul class="app-tabs" role="tablist">
                <li class="app-tabs__item js-tabs__item" role="presentation">
                    <a href="#{{ exampleId }}_html" role="tab" aria-controls="{{ exampleId }}_html" data-track="tab-html">HTML</a></li>
                {% if params.nunjucks %}
                    <li class="app-tabs__item js-tabs__item" role="presentation">
                        <a href="#{{ exampleId }}_nunjucks" role="tab" aria-controls="{{ exampleId }}_nunjucks" data-track="tab-nunjucks">Nunjucks</a>
                    </li>
                {% endif %}
            </ul>
            <div class="app-tabs__container js-tabs__container app-tabs__container--with-close-button js-hidden" 
                 id="{{ exampleId }}_html" 
                 role="tabpanel">
                <div id="{{ exampleId }}_english" 
                     aria-hidden="false">
                    <a class="govuk-link app-link--copy" 
                       href="#copy" 
                       aria-live="assertive">Copy</a>
                    <pre><code class="language-html">{% filter escape %}{% include htmlExampleLocation %}{% endfilter %}</code></pre>
                </div>
                {% if hasWelsh %}
                    <div id="{{ exampleId }}_welsh" class="govuk-visually-hidden" aria-hidden="true">
                        <a class="govuk-link app-link--copy" href="#copy" aria-live="assertive">Copy</a>
                        <pre><code class="language-html">{% filter escape %}{% include welshHtmlExampleLocation %}{% endfilter %}</code></pre>
                    </div>
                {% endif %}
                <a class="govuk-link app-link--close js-link--close app-chevron--top" href="#close">Close</a>
            </div>
            {% if params.nunjucks %}
                <div class="app-tabs__heading js-tabs__heading">
                    <a href="#{{ exampleId }}_nunjucks" role="tab" aria-controls="{{ exampleId }}_nunjucks" data-track="tab-nunjucks">Nunjucks</a></div>
                <div class="app-tabs__container js-tabs__container app-tabs__container--with-close-button" id="{{ exampleId }}_nunjucks"
                    role="tabpanel" style="display: none;">
                    <a class="app-link app-link--copy" href="#copy" aria-live="assertive">Copy</a>

                    <pre><code class="language-jinja">{% filter escape %}{%- include nunjucksExampleLocation -%}{% endfilter %}</code></pre>

                    <p class="app-tabs__text">You can configure this component using the
                        <a href="{# {{ params.macroParameters }} #}"
                            class="govuk-link" target="_blank" data-components="github-component-arguments" rel="noopener">Nunjucks
                            macro arguments</a>.
                    </p>
                    <a class="govuk-link app-link--close js-link--close app-chevron--top" href="#close">Close</a>
                </div>
            {% endif %}   
        {% endif %}
    </div>
</div>
{%- endmacro -%}